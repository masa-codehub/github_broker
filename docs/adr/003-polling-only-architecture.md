# ADR 003: ポーリング方式アーキテクチャへの完全移行

## Status

Accepted

## Context

ユーザーからの戦略的指示に基づき、プロジェクトのアーキテクチャをWebhookベースから、GitHub APIを定期的に確認する「ポーリング方式」に完全に切り替えることが決定されました。この決定は、ローカルでの開発体験を簡素化し、外部に公開するエンドポイントを持つことの複雑さを排除することを目的としています。これにより、セットアップが容易になり、セキュリティリスクも低減されます。

## Decision

今後、本プロジェクトにおけるタスク取得のメカニズムは、GitHub APIへのポーリング方式を唯一の公式な方法とします。Webhookに関連するすべての技術（APIエンドポイント、サービス、設定など）は廃止され、新規開発やリファクタリングにおいて使用を禁止します。

## 考慮事項

- **リアルタイム性:** ポーリング方式への移行により、Issueの変更がシステムに反映されるまでに遅延が生じます。この遅延は許容可能と判断しますが、ポーリング間隔は今後のパフォーマンス要件に応じて調整が必要です。
- **APIレート制限:** GitHub APIにはレート制限が存在します。ポーリング処理は、この制限に抵触しないよう、ETagを利用した条件付きリクエストを実装するなど、効率的な方法で行う必要があります。
- **エラーハンドリング:** ポーリング処理中のネットワークエラーやAPIからのエラーレスポンスに対する、具体的なエラーハンドリングとリトライ戦略は、実装フェーズで詳細に設計する必要があります。

## Consequences

この決定により、以下の影響が発生します。

- **`WebhookService` の廃止:** `github_broker/application/webhook_service.py` および関連するインターフェース（`api.py`内のエンドポイントなど）は、今後のリファクタリング作業で完全に削除されます。
- **`TaskService` の責務変更:** `TaskService` は、GitHub APIを定期的にポーリングしてIssue情報をローカルキャッシュ（Redis）に同期する責務を担うように変更されます。このポーリング処理は、独立したバックグラウンドプロセスとして起動されることを想定しています。
- **`docs/architecture/webhook-based-architecture.md` の廃止:** このアーキテクチャドキュメントは現状と一致しなくなるため、**廃止 (Deprecated)** されます。今後のアーキテクチャに関する参照は、このADRおよび将来作成されるポーリング方式の設計ドキュメントを参照してください。

