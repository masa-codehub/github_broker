# 005-multi-repository-support

## Context
現状のシステムでは、Redisキーの設計にリポジトリを識別する情報が含まれていません。例えば、`issue_lock` や `open_issues_cache` といったキーは、リポジトリ固有の情報を保持していません。このため、複数のリポジトリを同時に扱う場合、キーの衝突が発生し、データの一貫性が損なわれる可能性があります。結果として、現在の設計では単一のリポジトリしか安全に扱うことができません。

## Decision
将来的なマルチリポジトリ対応を可能にするため、すべてのRedisキーにリポジトリを一意に識別するためのプレフィックスを追加します。具体的なプレフィックスの形式は `repo_{owner}_{repo_name}:` とします。

例:
- `issue_lock` -> `repo_{owner}_{repo_name}:issue_lock`
- `open_issues_cache` -> `repo_{owner}_{repo_name}:open_issues_cache`

このプレフィックスは、Redisキーを使用するすべての箇所で適用されるものとします。

## Consequences
### メリット
- **マルチリポジトリ対応:** 複数のGitHubリポジトリを同時に安全に扱うことが可能になります。各リポジトリのデータは独立して管理されるため、キーの衝突による問題が解消されます。
- **スケーラビリティの向上:** 将来的にシステムが扱うリポジトリ数が増加しても、Redisキーの管理が容易になり、システムの拡張性が向上します。
- **明確なデータ分離:** Redis内のデータがどのリポジトリに属するのかが明確になり、デバッグや運用がしやすくなります。

### 既存コードへの影響範囲
- **Redisキー生成ロジックの変更:** Redisキーを生成しているすべての箇所で、新しいプレフィックスを追加するロジックを導入する必要があります。
- **既存データの移行:** マルチリポジトリ対応を完全に実施する場合、既存の単一リポジトリのRedisデータを新しいキー形式に移行する必要があります。ただし、これは本ADRの範囲外であり、別途検討が必要です。
- **テストの更新:** Redisキーの生成ロジックが変更されるため、関連する単体テストおよび統合テストの更新が必要になります。