# 概要 / Summary
[ADR-012] 主要ドキュメントのフォーマット検証をCIに統合

- **Status**: 提案中
- **Date**: 2025-10-19

## 状況 / Context

本プロジェクトでは、ADR (Architecture Decision Records), Design Docs, そして `plans` 配下の計画ファイル (Epics, Stories, Tasks) といった、多数のドキュメントが開発プロセスの中核を担っています。これらのドキュメントの一貫性と品質を維持することは、プロジェクトの透明性とメンテナンス性を保つ上で極めて重要です。

しかし、これらのドキュメントのフォーマット（必須セクションの有無、命名規則、フォルダ構成など）は、現状ではレビュアーによる手動での確認に依存しています。これにより、以下のような課題が生じています。

-   **抜け漏れの発生:** 人間の目によるレビューでは、必須項目の抜け漏れや、規約違反を完全には防ぎきれない。
-   **レビュー負荷の増大:** レビュアーは、本来集中すべき設計やロジックの内容よりも、フォーマットのチェックに時間を割かれてしまう。
-   **規約の形骸化:** プロジェクトが拡大するにつれて、規約の遵守が徹底されにくくなる。

これらの課題を解決し、ドキュメントの品質を自動的に保証する仕組みが必要です。

## 決定 / Decision

プロジェクト内の主要なMarkdownドキュメントのフォーマットを自動的に検証する仕組みを、CIプロセスに統合します。具体的な内容は以下の通りです。

1.  **検証スクリプトの作成:**
    以下のルールを検証する単一のPythonスクリプトを作成します。

    -   **対象ファイル:**
        -   `docs/adr/*.md`
        -   `docs/design-docs/*.md`
        -   `plans/**/*.md`

    -   **検証ロジック:**
        1.  **ファイル名チェック (plans配下):** `plans` 配下のMarkdownファイル名が、`epic-`, `story-`, `task-` のいずれかの接頭辞で始まっていることを検証する。
        2.  **フォルダ構成チェック (plans配下):**
            -   `story-*.md` という名前のファイルは、必ず `stories/` サブディレクトリ内に配置されなければならない。
            -   `task-*.md` という名前のファイルは、必ず `tasks/` サブディレクトリ内に配置されなければならない。
        3.  **内容チェック (全対象ファイル):** 各ドキュメントタイプに応じて、定義された必須セクション（Markdownのヘッダーとして表現）がすべてファイル内に存在することを検証する。

2.  **CIへの統合:**
    作成したPythonスクリプトを `.pre-commit-config.yaml` に新しいフックとして追加します。これにより、ローカル環境でのコミット時と、GitHub Actions上でのCI実行時の両方で、自動的に検証が実行されます。

3.  **失敗時の挙動:**
    検証スクリプトが何らかの規約違反を検知した場合、**どのファイルのどのルールに違反したかを具体的に示すエラーメッセージ（例: `ERROR: docs/adr/013.md - Missing required section: "## Decision (決定)"`）を標準エラー出力に表示し、**スクリプトは非ゼロの終了コードで終了します。これにより、`pre-commit` フックが作動し、開発者は即座に問題の内容と場所を把握できます。

## 結果

## 結果 / Consequences

### メリット (Positive consequences)

-   **品質の自動保証:** ドキュメントのフォーマット、命名規則、構成が常に規約に準拠していることが自動的に保証されます。
-   **レビュー効率の向上:** レビュアーはフォーマットの心配をすることなく、ドキュメントの内容そのもののレビューに集中できます。
-   **早期フィードバック:** 開発者はコミット時に即座にフィードバックを受け取れるため、CIでエラーが発覚する前に問題を修正できます。
-   **ドキュメントの一貫性維持:** プロジェクトがスケールしても、ドキュメント全体の構造的な一貫性が保たれます。

### デメリット (Negative consequences)

-   **初期実装コスト:** 検証スクリプトの作成と、CIへの統合に初期開発コストがかかります。
-   **規約変更時のメンテナンス:** ドキュメントのテンプレートや規約が変更された場合、検証スクリプトも合わせて更新する必要があります。

## Verification Criteria (検証基準)

この意思決定が正しく実装されたことは、以下の方法で確認できます。

-   `docs/adr/` 配下に、必須セクション（例: `## Decision (決定)`) が欠けたMarkdownファイルを追加してコミットしようとすると、`pre-commit` が**具体的なエラーメッセージを出力して**コミットが失敗すること。
-   `plans/adr-xxx/` の直下に `story-my-story.md` というファイルを追加してコミットしようとすると、フォルダ構成違反として**具体的なエラーメッセージを出力して**コミットが失敗すること。
-   上記と同様の変更を含むPull Requestを作成した際に、GitHub ActionsのCIチェックが失敗し、**ログに具体的なエラーメッセージが出力される**こと。
-   すべての規約を遵守したドキュメントを追加・変更した場合は、コミットおよびCIが正常に成功すること。

## 状況

## Status
未着手