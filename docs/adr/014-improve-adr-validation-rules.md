# 概要 / Summary
[ADR-014] ドキュメント検証規約の改善

- **Status**: 提案中
- **Date**: 2025-10-23

## 状況 / Context

現在のドキュメント検証スクリプト (`scripts/validate_docs.py`) は、ADRおよびDesign Docファイルに、ごく基本的なセクションが存在することのみをチェックしています。しかし、これだけではドキュメントの品質を保証するには不十分であることが、最近の複数のコミットエラーや議論から判明しました。

現在の規約には、意思決定の追跡可能性や検証可能性に不可欠なセクション（例: `Status`, `Verification Criteria`）のチェックが欠けています。一方で、エージェントの行動規範（`SYSTEM_ARCHITECT.md`）に存在するテンプレートは、より包括的であるものの、検証規約と一致していませんでした。

議論の結果、両者の良い部分を統合し、より高品質で一貫性のある「最終版テンプレート」を新しい公式規約として定め、それをシステムで強制する方針となりました。

## 決定 / Decision

ADRとDesign Docの公式テンプレートを以下のように最終決定し、検証スクリプト `scripts/validate_docs.py` を、この新しい規約を強制するように修正します。

### 1. ADR (`docs/adr/*.md`) の最終テンプレートと検証ロジック

**必須セクション:**
ADRは、以下の文字列がファイル内に存在することを必須とします。
1.  `# 概要 / Summary`
2.  `- Status:`
3.  `- Date:`
4.  `## 状況 / Context`
5.  `## 決定 / Decision`
6.  `## 結果 / Consequences`
7.  `## 検証基準 / Verification Criteria`
8.  `## 実装状況 / Implementation Status`

**追加の検証ロジック:**
- `# 概要 / Summary` の直後の行が、正規表現 `^[ADR-\d+]` に一致すること（例: `[ADR-001]...`）を検証するロジックを追加します。

### 2. Design Doc (`docs/design-docs/*.md`) の最終テンプレートと検証ロジック

**必須セクション:**
Design Docは、以下の文字列がファイル内に存在することを必須とします。
1.  `# 概要 / Overview`
2.  `## 背景と課題 / Background`
3.  `## ゴール / Goals`
4.  `## 設計 / Design`
5.  `## 考慮事項 / Considerations` （代替案、セキュリティ、未解決の問題点などを含む）
6.  `## 検証基準 / Verification Criteria`
7.  `## 実装状況 / Implementation Status`

**追加の検証ロジック:**
- `# 概要 / Overview` の直後の行が、`デザインドキュメント:` で始まることを検証するロジックを追加します。
- `## 考慮事項 / Considerations` セクションには、代替案、セキュリティ、未解決の問題点などを含むことを推奨しますが、これらのサブセクションの存在は必須とはしません。

### 3. 検証スクリプトの修正方針
`scripts/validate_docs.py` を修正し、上記で定義された必須セクションの存在チェックと、タイトル行のフォーマットを検証する正規表現チェックを実装します。

## 結果 / Consequences

### メリット (Positive consequences)

- **ドキュメント品質の標準化:** ADRとDesign Docの両方で、高品質で一貫性のあるフォーマットが保証されます。
- **追跡可能性と検証可能性の向上:** `Status`や`検証基準`などが必須となることで、すべての設計決定が追跡・検証可能になります。
- **規約の明確化:** 作成者が従うべきルールが明確になり、ドキュメント作成の効率と質が向上します。

### デメリット (Negative consequences)

- **ドキュメント作成の厳格化:** ドキュメント作成時の手間がわずかに増加しますが、これは品質向上のための健全なトレードオフです。

## 検証基準 / Verification Criteria

この意思決定が正しく実装されたことは、以下の方法で確認できます。

- 新しい検証規約に準拠していないADRまたはDesign Docファイルをコミットしようとすると、`pre-commit`フックがエラーを出力して失敗すること。
- 新しい検証規約の必須セクションをすべて満たしたADRおよびDesign Docファイルは、コミットが成功すること。

## 実装状況 / Implementation Status
未着手