# 概要 / Summary
[ADR-019] Issue Creator Workflowの修正とフロントマター検証の導入

- Status: 提案中
- Date: 2025-11-22

## 状況 / Context

`issue_creator.yml` GitHub Actionsワークフローが、以下の2つの主要な理由により失敗しています。

1.  **フロントマターの欠如:** `_in_box`ディレクトリに配置されたIssue化対象のマークダウンファイルに、Issueのタイトルなどを含むべきYAMLフロントマターが存在しませんでした。これにより、Pythonスクリプトが情報を解析できず、エラーで停止しました。
2.  **ブランチ保護ルールの違反:** ワークフローは、処理済みファイルを`_in_box`から`_done_box`または`_failed_box`へ移動した後、その変更を直接`main`ブランチに`git push`しようとします。しかし、`main`ブランチはPull Request経由での変更のみを許可するルールで保護されているため、プッシュが拒否され、ワークフローが最終的に失敗していました。

## 決定 / Decision

Issue作成プロセスをより堅牢にし、リポジトリのルールを遵守するため、以下の2段階の修正を実施します。

1.  **`pre-commit`フックによるフロントマター検証の導入:**
    *   `_in_box`ディレクトリにコミットされる全てのマークダウンファイルを対象とする、新しい`pre-commit`フックを追加します。
    *   このフックは、各ファイルが`---`で区切られた有効なYAMLフロントマターを持ち、かつ必須フィールド（最低でも`title`）が存在することを検証します。
    *   検証に失敗した場合、コミットは自動的に失敗します。これにより、フォーマットが不正なファイルがリポジトリにマージされることを未然に防ぎます。

2.  **ファイル移動処理のPull Request化:**
    *   `issue_creator.yml`ワークフローの最終ステップを変更します。
    *   `git push`による直接コミットを廃止し、代わりに`create-pull-request`のようなGitHub Actionを利用します。
    *   このActionは、`_in_box`から`_done_box`へのファイル移動の差分を含む新しいPull Requestを自動で作成します。

## 結果 / Consequences

### メリット (Positive consequences)

-   **品質向上:** `pre-commit`フックにより、Issue化の前提条件となるファイルの品質がコミット時点で保証されます。
-   **安定性の向上:** フロントマターの欠如によるワークフローの実行時エラーが根本的に解消されます。
-   **コンプライアンス遵守:** ワークフローが`main`ブランチの保護ルールに違反することがなくなります。
-   **監査証跡:** ファイルの移動がPull Requestとして記録されるため、いつ、どのファイルが処理されたかの追跡が容易になります。

### デメリット (Negative consequences)

-   **プロセスの追加:** ワークフローが実行されるたびに、ファイル移動を確定させるためのPull Requestが生成され、そのマージ作業が追加で必要になります。（ただし、このマージは自動化することも可能です）

## 検証基準 / Verification Criteria

-   フロントマターを持たない`.md`ファイルを`_in_box`にコミットしようとすると、`pre-commit`フックがエラーを返し、コミットが失敗すること。
-   フロントマターを持つ`.md`ファイルを`_in_box`に配置したPRをマージした後、`issue_creator.yml`ワークフローがトリガーされ、正常にIssueが作成されること。
-   Issue作成後、ワークフローが「chore: Move processed issue files」のようなタイトルのPull Requestを自動で作成すること。
-   そのPull Requestには、`_in_box`から`_done_box`へ該当ファイルが移動された差分のみが含まれていること。

## 実装状況 / Implementation Status
- [ ] 未着手