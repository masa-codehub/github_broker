# 概要 / Overview
デザインドキュメント: [ADR-012] 主要ドキュメントのフォーマット検証をCIに統合

## 背景と課題 / Background

本プロジェクトでは、ADR (Architecture Decision Records), Design Docs, そして `plans` 配下の計画ファイル (Epics, Stories, Tasks) といった、多数のドキュメントが開発プロセスの中核を担っています。これらのドキュメントの一貫性と品質を維持することは、プロジェクトの透明性とメンテナンス性を保つ上で極めて重要です。

しかし、これらのドキュメントのフォーマット（必須セクションの有無、命名規則、フォルダ構成など）は、現状ではレビュアーによる手動での確認に依存しています。これにより、以下のような課題が生じています。

-   **抜け漏れの発生:** 人間の目によるレビューでは、必須項目の抜け漏れや、規約違反を完全には防ぎきれない。
-   **レビュー負荷の増大:** レビュアーは、本来集中すべき設計やロジックの内容よりも、フォーマットのチェックに時間を割かれてしまう。
-   **規約の形骸化:** プロジェクトが拡大するにつれて、規約の遵守が徹底されにくくなる。

## ゴール / Goals

これらの課題を解決し、ドキュメントの品質を自動的に保証する仕組みを構築することで、プロジェクトの透明性、メンテナンス性、および開発プロセスの効率を向上させる。

### 機能要件 / Functional Requirements

-   **検証スクリプトの作成:**
    以下のルールを検証する単一のPythonスクリプトを作成します。
    -   **対象ファイル:**
        -   `docs/adr/*.md`
        -   `docs/design-docs/*.md`
        -   `plans/**/*.md`
    -   **検証ロジック:**
        1.  **ファイル名チェック (plans配下):** `plans` 配下のMarkdownファイル名が、`epic-`, `story-`, `task-` のいずれかの接頭辞で始まっていることを検証する。
        2.  **フォルダ構成チェック (plans配下):**
            -   `story-*.md` という名前のファイルは、必ず `stories/` サブディレクトリ内に配置されなければならない。
            -   `task-*.md` という名前のファイルは、必ず `tasks/` サブディレクトリ内に配置されなければならない。
        3.  **内容チェック (全対象ファイル):** 各ドキュメントタイプに応じて、定義された必須セクション（Markdownのヘッダーとして表現）がすべてファイル内に存在することを検証する。
-   **CIへの統合:**
    作成した検証ロジックを `.pre-commit-config.yaml` に新しいフックとして追加します。これにより、ローカル環境でのコミット時と、GitHub Actions上でのCI実行時の両方で、自動的に検証が実行されます。
-   **失敗時の挙動:**
    検証スクリプトが何らかの規約違反を検知した場合、**どのファイルのどのルールに違反したかを具体的に示すエラーメッセージ（例: `ERROR: docs/adr/013.md - Missing required section: "## Decision (決定)"`）を標準エラー出力に表示し、**スクリプトは非ゼロの終了コードで終了します。

### 非機能要件 / Non-Functional Requirements

-   **品質の自動保証:** ドキュメントのフォーマット、命名規則、構成が常に規約に準拠していることが自動的に保証されること。
-   **レビュー効率の向上:** レビュアーがフォーマットの心配をすることなく、ドキュメントの内容そのものレビューに集中できること。
-   **早期フィードバック:** 開発者がコミット時に即座にフィードバックを受け取れること。
-   **ドキュメントの一貫性維持:** プロジェクトがスケールしても、ドキュメント全体の構造的な一貫性が保たれること。

## 設計 / Design

### ハイレベル設計 / High-Level Design

プロジェクト内の主要なMarkdownドキュメントのフォーマットを自動的に検証する仕組みを、CIプロセスに統合します。単一のPythonスクリプトが検証ロジックを担当し、`pre-commit` フックを通じてローカルおよびCI環境で実行されます。

### 詳細設計 / Detailed Design

#### 検証スクリプト

-   **言語:** Python
-   **検証対象:**
    -   `docs/adr/*.md`
    -   `docs/design-docs/*.md`
    -   `plans/**/*.md`
-   **検証内容:**
    -   ファイル名プレフィックス (`epic-`, `story-`, `task-`) 検証 (plans配下)
    -   フォルダ構造検証 (`story-*.md` は `stories/`、`task-*.md` は `tasks/` サブディレクトリ内) (plans配下)
    -   必須セクションの存在検証 (ドキュメントタイプに応じたMarkdownヘッダー)
-   **エラー報告:** 違反時には具体的なエラーメッセージを標準エラー出力に表示し、非ゼロ終了コードで終了。

#### CI統合

-   `.pre-commit-config.yaml` に新しいフックとして検証スクリプトを追加。

## 検討した代替案 / Alternatives Considered

（特になし。ADRでは代替案の検討は明示されていませんでした。）

## セキュリティとプライバシー / Security & Privacy

（特になし。本設計はドキュメントのフォーマット検証に関するものであり、直接的なセキュリティやプライバシーへの影響はありません。）

## 未解決の問題 / Open Questions & Unresolved Issues

（特になし。）

## 検証基準 / Verification Criteria

この設計が正しく実装されたことは、以下の方法で確認できます。

-   `docs/adr/` 配下に、必須セクションが欠けたMarkdownファイルを追加してコミットしようとすると、`pre-commit` が**具体的なエラーメッセージを出力して**コミットが失敗すること。
-   `plans/adr-xxx/` の直下に `story-my-story.md` というファイルを追加してコミットしようとすると、フォルダ構成違反として**具体的なエラーメッセージを出力して**コミットが失敗すること。
-   上記と同様の変更を含むPull Requestを作成した際に、GitHub ActionsのCIチェックが失敗し、**ログに具体的なエラーメッセージが出力される**こと。
-   すべての規約を遵守したドキュメントを追加・変更した場合は、コミットおよびCIが正常に成功すること。

## 実装状況 / Implementation Status

完了